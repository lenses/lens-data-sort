<link rel="import" href="../polymer/polymer.html"> 
<link rel="import" href="../th-theme/th-theme.html"> 

<!--
A Thelma component providing solution to no problem in particular.

##### Example

    <th-data-sort></th-data-sort>

@element th-data-sort
@blurb Element providing solution to no problem in particular.
@status alpha
@homepage http://thelmanews.github.io/th-data-sort
-->

<polymer-element name="th-data-sort" attributes="input output">
  <template>
    <core-style ref="theme"></core-style>
    <link rel="stylesheet" href="th-data-sort.css">

    <template if="{{!included}}">
      <core-icon-button icon="perm-data-setting" on-click="{{showControls}}"></core-icon-button>
    </template>

    <core-collapse id="ctrl_collapse">      

            <p class="info">Sort rows.</p>
            <label for="func_selector">Sort by column:</label>
            <core-selector id="value_selector" selected="{{sortColumn}}" valueattr="label">
              <template repeat="{{attr in _dataAttributes}}">
                <div class="col" label="{{attr}}">{{attr}}</div>
              </template>
            </core-selector>
            <label for="sort_selector">Sort order:</label>
            <core-selector id="func_selector" id="" selected="{{selectedSort}}" valueattr="label">
                <div class="col" label="asc">Ascending</div>
                <div class="col" label="desc">Descending</div>
            </core-selector>

  </template>

  <script src="../lodash/dist/lodash.js"></script>

  <script>
    Polymer({
      selectedSort: 'asc',
      ready: function () {
        //open the collapse if it the component is included
        if(this.included && !this.$.ctrl_collapse.opened) {
          this.$.ctrl_collapse.toggle();
        }
      },
      inputChanged: function() {

          var self = this;
          var firstItem = self.input[0];
          if(!firstItem) {
            return;
          }
          var attributes = Object.keys(firstItem);
          
          if(JSON.stringify(self._dataAttributes) === JSON.stringify(attributes) ) {
            //self._mapChartData();
          }
          else {
            self._dataAttributes = attributes;
          }

          self._calculateOutput();          

      }, 

      _calculateOutput: function() {

        var self = this;
        if(self.sortColumn)
        {
            self.output = _.sortBy(self.input, self.sortColumn);
            if(self.selectedSort==='desc') {
              self.output.reverse();
            }

        }

      },     

      sortColumnChanged: function(e) {
        
        var self= this;
        self._calculateOutput();

      },
      selectedSortChanged: function(e) {
        
        var self= this;
        self._calculateOutput();

      },
      showControls: function(e) {
        this.$.ctrl_collapse.toggle();
      },

    });

  </script>
</polymer-element>